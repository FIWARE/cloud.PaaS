<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <!-- migration from essex to grizzly -->
    <changeSet author="jesuspg (generated)" id="129">
        <createTable tableName="artifact_attribute">
            <column name="artifact_id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="attributes_id" type="INT8">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="130">
        <createTable tableName="network">
            <column name="id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="idnetwork" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="subnetcount" type="INT4">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="131">
        <createTable tableName="network_router">
            <column name="network_id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="routers_id" type="INT8">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="132">
        <createTable tableName="network_subnetwork">
            <column name="network_id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="subnets_id" type="INT8">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="133">
        <createTable tableName="networkinstance">
            <column name="id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="idnetwork" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="subnetcount" type="INT4">
                <constraints nullable="false"/>
            </column>
            <column name="adminstateup" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="netdefault" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="shared" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="tenantid" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="134">
        <createTable tableName="networkinstance_router">
            <column name="networkinstance_id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="routers_id" type="INT8">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="135">
        <createTable tableName="networkinstance_subnetworkinstance">
            <column name="networkinstance_id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="subnets_id" type="INT8">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="136">
        <createTable tableName="router">
            <column name="id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="idpublicnetwork" type="VARCHAR(255)"/>
            <column name="idrouter" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="137">
        <createTable tableName="subnetwork">
            <column name="id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="allocationpoolsend" type="VARCHAR(255)"/>
            <column name="allocationpoolsstart" type="VARCHAR(255)"/>
            <column name="cidr" type="VARCHAR(255)"/>
            <column name="idnetwork" type="VARCHAR(255)"/>
            <column name="idsubnet" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="138">
        <createTable tableName="subnetworkinstance">
            <column name="id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="allocationpoolsend" type="VARCHAR(255)"/>
            <column name="allocationpoolsstart" type="VARCHAR(255)"/>
            <column name="cidr" type="VARCHAR(255)"/>
            <column name="idnetwork" type="VARCHAR(255)"/>
            <column name="idsubnet" type="VARCHAR(255)"/>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="139">
        <createTable tableName="tier_has_networks">
            <column name="tier_id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="network_id" type="INT8">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="140">
        <createTable tableName="tierinstance_has_networkinstance">
            <column name="tierinstance_id" type="INT8">
                <constraints nullable="false"/>
            </column>
            <column name="networkinstance_id" type="INT8">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="141">
        <addColumn tableName="tier">
            <column name="region" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="142">
        <addPrimaryKey columnNames="id" constraintName="network_pkey" tableName="network"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="143">
        <addPrimaryKey columnNames="id" constraintName="networkinstance_pkey" tableName="networkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="144">
        <addPrimaryKey columnNames="networkinstance_id, routers_id" constraintName="networkinstance_router_pkey"
                       tableName="networkinstance_router"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="145">
        <addPrimaryKey columnNames="networkinstance_id, subnets_id"
                       constraintName="networkinstance_subnetworkinstance_pkey"
                       tableName="networkinstance_subnetworkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="146">
        <addPrimaryKey columnNames="id" constraintName="router_pkey" tableName="router"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="147">
        <addPrimaryKey columnNames="id" constraintName="subnetwork_pkey" tableName="subnetwork"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="148">
        <addPrimaryKey columnNames="id" constraintName="subnetworkinstance_pkey" tableName="subnetworkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="149">
        <addPrimaryKey columnNames="tierinstance_id, networkinstance_id"
                       constraintName="tierinstance_has_networkinstance_pkey"
                       tableName="tierinstance_has_networkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="150">
        <addForeignKeyConstraint baseColumnNames="routers_id" baseTableName="networkinstance_router"
                                 constraintName="fk29eb3265750bb3be" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="router"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="151">
        <addForeignKeyConstraint baseColumnNames="networkinstance_id" baseTableName="networkinstance_router"
                                 constraintName="fk29eb3265fd97b36a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="networkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="152">
        <addForeignKeyConstraint baseColumnNames="routers_id" baseTableName="network_router"
                                 constraintName="fk2f32c2ba3a38a409" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="router"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="153">
        <addForeignKeyConstraint baseColumnNames="network_id" baseTableName="network_router"
                                 constraintName="fk2f32c2ba54c6c36a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="network"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="154">
        <addForeignKeyConstraint baseColumnNames="tierinstance_id" baseTableName="tierinstance_has_networkinstance"
                                 constraintName="fk305ce55619388c0a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="tierinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="155">
        <addForeignKeyConstraint baseColumnNames="networkinstance_id" baseTableName="tierinstance_has_networkinstance"
                                 constraintName="fk305ce556fd97b36a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="networkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="156">
        <addForeignKeyConstraint baseColumnNames="tier_id" baseTableName="tier_has_networks"
                                 constraintName="fk38408f47349a3c0a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="tier"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="157">
        <addForeignKeyConstraint baseColumnNames="network_id" baseTableName="tier_has_networks"
                                 constraintName="fk38408f4754c6c36a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="network"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="158">
        <addForeignKeyConstraint baseColumnNames="subnets_id" baseTableName="networkinstance_subnetworkinstance"
                                 constraintName="fkcc8cc79fc428ad57" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="subnetworkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="159">
        <addForeignKeyConstraint baseColumnNames="networkinstance_id" baseTableName="networkinstance_subnetworkinstance"
                                 constraintName="fkcc8cc79ffd97b36a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="networkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="160">
        <addForeignKeyConstraint baseColumnNames="attributes_id" baseTableName="artifact_attribute"
                                 constraintName="fkd498e86f6ed4ac0f" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="attribute"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="161">
        <addForeignKeyConstraint baseColumnNames="artifact_id" baseTableName="artifact_attribute"
                                 constraintName="fkd498e86fdcd52e0a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="artifact"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="162">
        <addForeignKeyConstraint baseColumnNames="network_id" baseTableName="network_subnetwork"
                                 constraintName="fkdc93b6bf54c6c36a" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="network"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="163">
        <addForeignKeyConstraint baseColumnNames="subnets_id" baseTableName="network_subnetwork"
                                 constraintName="fkdc93b6bf8f53f2a2" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id"
                                 referencedTableName="subnetwork"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="164">
        <addUniqueConstraint columnNames="attributes_id" constraintName="artifact_attribute_attributes_id_key"
                             deferrable="false" disabled="false" initiallyDeferred="false"
                             tableName="artifact_attribute"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="165">
        <addUniqueConstraint columnNames="routers_id" constraintName="network_router_routers_id_key" deferrable="false"
                             disabled="false" initiallyDeferred="false" tableName="network_router"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="166">
        <addUniqueConstraint columnNames="subnets_id" constraintName="network_subnetwork_subnets_id_key"
                             deferrable="false" disabled="false" initiallyDeferred="false"
                             tableName="network_subnetwork"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="167">
        <addUniqueConstraint columnNames="routers_id" constraintName="networkinstance_router_routers_id_key"
                             deferrable="false" disabled="false" initiallyDeferred="false"
                             tableName="networkinstance_router"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="168">
        <addUniqueConstraint columnNames="subnets_id" constraintName="networkinstance_subnetworkinstance_subnets_id_key"
                             deferrable="false" disabled="false" initiallyDeferred="false"
                             tableName="networkinstance_subnetworkinstance"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="169">
        <dropForeignKeyConstraint baseTableName="environment" constraintName="fk5e4ad9f31bfaef2a"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="170">
        <dropForeignKeyConstraint baseTableName="applicationtype_environmenttype" constraintName="fkd97d461828bcb611"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="171">
        <dropForeignKeyConstraint baseTableName="applicationtype_environmenttype" constraintName="fkd97d461846195a0a"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="172">
        <dropUniqueConstraint constraintName="applicationtype_environmenttype_environmenttypes_id_key"
                              tableName="applicationtype_environmenttype"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="173">
        <dropUniqueConstraint constraintName="environmenttype_name_key" tableName="environmenttype"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="174">
        <dropTable tableName="applicationtype_environmenttype"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="175">
        <dropTable tableName="environmenttype"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="176">
        <dropColumn columnName="environmenttype_id" tableName="environment"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="177">
        <dropColumn columnName="version" tableName="environment"/>
    </changeSet>
    <changeSet author="jesuspg (generated)" id="178">
        <modifyDataType columnName="networks" newDataType="bytea" tableName="tierinstance"/>
    </changeSet>

</databaseChangeLog>
