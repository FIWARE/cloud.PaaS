'''
Created on 06/06/2013

@author: jmms392
'''
import httplib
import sys
import os
from xml.dom.minidom import parse, parseString
from xml.dom.minidom import getDOMImplementation
from xml.etree.ElementTree import Element, SubElement, tostring
import httplib, urllib
import utils


vm_fqn = 'fqn6'
vm_ip = '130.206.80.114'
product_name = 'test'
product_version = '0.1'
vdc = 'ebe6d9ec7b024361b7a3882c65a57dda'
user = 'jesus'
password='susje'
project ='jesusproject'
org = 'FIWARE'

domine = "localhost"
environment_name = '10Envjune02'
bluename = environment_name + '-bp'

token = utils.obtainToken (user, password, project)
print(token)

port ="8080"
headers = {'Content-Type': 'application/xml', 'X-Auth-Token':   token  ,  'Tenant-ID': vdc}
print(headers)


print('Create a blueprint Template No tiers for contextbroker: ')
environmentDto =  utils.createEnvironmentDtoNoTiers (environment_name)
print (tostring(environmentDto))
resource_blueprint = "/paasmanager/rest/catalog/org/FIWARE/vdc/"+vdc+"/environment"
utils.doRequestHttpOperation(domine, port,resource_blueprint, 'POST',tostring(environmentDto),headers)
print("  OK")

print('Create createTierNoProduct: tiermongoconfig')
tier_name = environment_name  + 'moncfig55'
tiertDto =  utils.createTierNoProductFlavor (tier_name, '1')
print (tostring(tiertDto))
tierresource_blueprint = "/paasmanager/rest/catalog/org/FIWARE/vdc/"+vdc+"/environment/"+environment_name+"/tier"
utils.doRequestHttpOperation(domine, port,tierresource_blueprint, 'POST',tostring(tiertDto),headers)
print("  OK")

print('Create productReelaseDto mongoconfig: ')
productReelaseDto =  utils.createProductRelease ('nodejs','0.6.15')
print (tostring(productReelaseDto))
product_reelease_source_blueprint = "/paasmanager/rest/catalog/org/FIWARE/vdc/"+vdc+"/environment/"+environment_name+"/tier/"+tier_name+"/productRelease"
utils.doRequestHttpOperation(domine, port,product_reelease_source_blueprint, 'POST',tostring(productReelaseDto),headers)
print("  OK")

print('Borrado Tier: tiermongoconfig')
tierresource_blueprint = "/paasmanager/rest/catalog/org/FIWARE/vdc/"+vdc+"/environment/"+environment_name+"/tier/"+tier_name
utils.doRequestHttpOperation(domine, port,tierresource_blueprint, 'DELETE',None,headers)
print("  OK")

print('Create createTierNoProduct: tiermongoconfig')
tier_name = environment_name  + 'moncfig55'
tiertDto =  utils.createTierNoProductFlavor (tier_name, '2')
print (tostring(tiertDto))
tierresource_blueprint = "/paasmanager/rest/catalog/org/FIWARE/vdc/"+vdc+"/environment/"+environment_name+"/tier"
utils.doRequestHttpOperation(domine, port,tierresource_blueprint, 'POST',tostring(tiertDto),headers)
print("  OK")

print('Create productReelaseDto mongoconfig: ')
productReelaseDto =  utils.createProductRelease ('nodejs','0.6.15')
print (tostring(productReelaseDto))
product_reelease_source_blueprint = "/paasmanager/rest/catalog/org/FIWARE/vdc/"+vdc+"/environment/"+environment_name+"/tier/"+tier_name+"/productRelease"
utils.doRequestHttpOperation(domine, port,product_reelease_source_blueprint, 'POST',tostring(productReelaseDto),headers)
print("  OK")